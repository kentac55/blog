import Layout from 'lib/components/layout'
import { Card, Image } from '@zeit-ui/react'

export const meta = {
  title: 'ãŠã†ã¡ã‚¤ãƒ³ãƒ•ãƒ©_Internetæ¥ç¶šç·¨',
  date: '2020-06-07 18:15',
  description: 'è‡ªå®…ã®ã‚¤ãƒ³ãƒ•ãƒ©ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’NVR700Wã‚’åˆ©ç”¨ã—ã¦å¿«é©ã«ã—ã¦ã¿ãŸãŠè©±',
  image: '',
  tags: 'ãŠã†ã¡ã‚¤ãƒ³ãƒ•ãƒ©,network'
}

è‡ªå®…ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰ã®ãƒ¡ãƒ¢ã€‚

ä»Šå›ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã«ã¤ã„ã¦ã€‚

## ç’°å¢ƒ

å…¨ä½“å›³ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚

<Image width="888" height="520" alt="å…¨ä½“å›³" src="/images/20200607_210722.png" />

ä»Šå›ã®ãƒ¡ãƒ¢ã¯è–„é»„è‰²ã®ä¸¸ã®éƒ¨åˆ†ã€‚

ãƒ•ãƒ¬ãƒƒãƒ„ã¨ã²ã‹ã‚Šé›»è©±ã¨ãƒ—ãƒ­ãƒã‚¤ãƒ€å¥‘ç´„ã¯IIJmioå…‰ã®å…‰ã‚³ãƒ©ãƒœã€‚HGWã¯PR-400KIã€‚IPv6 IPoEã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ã(æœ€è¿‘ç„¡æ–™ã«ãªã£ãŸ)ã€‚

SIMã‚«ãƒ¼ãƒ‰ã‚’åˆºã—ã¦è‰²ã€…éŠã‚“ã§ã¿ãŸã„ã®ã§NVR700Wã‚’è²·ã£ãŸã€‚LTEæ©Ÿèƒ½ãŒä¸è¦ãªã‚‰RTX1210ã‚„RTX830ã§ã‚‚è‰¯ã„(LTEæ©Ÿèƒ½ã‚’æŠœãã«ã—ã¦ã‚‚VPNã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ2Gbpsã¯é­…åŠ›çš„)ã€‚

Cat3560ã¯ãƒ¤ãƒ•ã‚ªã‚¯ã§è²·ã£ãŸã€‚2960åŒæ§˜ãƒ•ã‚¡ãƒ³ãƒ¬ã‚¹ãªã®ã§è‡ªå®…ã«è¨­ç½®ã—ã‚„ã™ã„ã€‚ãƒªãƒ“ãƒ³ã‚°ã«è¨­ç½®ã™ã‚‹éƒ½åˆä¸Šã‚ˆãå®¶æ—ã«è™å¾…(æ—¥å…‰æµ´ãƒ»ã‚³ãƒ¼ãƒ’ãƒ¼ã¶ã£ã‹ã‘ç­‰)ã•ã‚Œã¦ã„ã‚‹ã€‚ã™ã¾ã‚“ã€‚

æ˜”ã¯NVR700Wã®ä½ç½®ã«EdgeRouter-XãŒã„ãŸã‘ã©VPNã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆãŒ100-200Mbpsç¨‹åº¦ã ã£ãŸã®ã§ãƒªã‚¹ãƒˆãƒ©ã€‚

## ã„ã–æ§‹ç¯‰

### HGWã«ã©ã“ã¾ã§ã®è²¬å‹™ã‚’æŒãŸã›ã‚‹ã‹ï¼Ÿ

è‡ªå‰PPPoEçµ‚ç«¯ãŒã§ãã¦é€šè©±æ©Ÿèƒ½ã‚’æŒã¤NVR700Wã®ã‚ˆã†ãªãƒ«ãƒ¼ã‚¿ãƒ¼ãŒã‚ã‚‹ã¨HGWã«ã©ã“ã¾ã§ã®æ©Ÿèƒ½ã‚’ä»»ã›ã‚‹ã®ã‹ãŒä¸€ã¤ã®ãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹ã€‚

ãã®ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’æ›¸ã„ã¦ã„ãã€‚

ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†ã‘ã™ã‚‹ã¨ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | PPPoEçµ‚ç«¯ | é€šè©±  | IPv6PDå†é…å¸ƒ |
| --- | --- | --- | --- | --- | --- |
| A | HGW | HGW | HGW |
| B | ãƒ«ãƒ¼ã‚¿ãƒ¼ | HGW | HGW |
| C | ãƒ«ãƒ¼ã‚¿ãƒ¼ | ãƒ«ãƒ¼ã‚¿ãƒ¼ | HGW |
| D | ãƒ«ãƒ¼ã‚¿ãƒ¼ | ãƒ«ãƒ¼ã‚¿ãƒ¼ | ãƒ«ãƒ¼ã‚¿ãƒ¼ |


#### A: HGWã§PPPoEçµ‚ç«¯ã‚’ã—ã¦ãƒ«ãƒ¼ã‚¿ãƒ¼ã«é™çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

HGWã§NATã™ã‚‹ã‚„ã¤(æ™®é€šã®ã‚„ã¤)ã€‚

LANå´ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’åˆ‡ã£ã¦ã„ã‚‹å ´åˆHGWã®ã€ŒLANå´é™çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ã‹ã‚‰static routeã‚’å…¥ã‚Œã‚‹ã®ã‚’å¿˜ã‚Œãšã«ã€‚

- ğŸ‘
    - æ€§èƒ½ãŒå¾®å¦™ãªHGWã«è‰²ã€…ã‚„ã‚‰ã›ã‚‹ã¨éŠã³ãŸã„æ™‚è‰²ã€…ã¤ã‚‰ã„
    - ãƒ«ãƒ¼ã‚¿ãƒ¼ã§IPv4 over IPv6ã¿ãŸã„ãªã“ã¨ã‚’ã—å§‹ã‚ã‚‹ã¨ãƒ•ã‚£ãƒ«ã‚¿ã®äºŒé‡ç®¡ç†ãŒå§‹ã¾ã‚‹

#### B: HGWã§é€šè©±ã®ã¿ç®¡ç†ã—ã¦ãƒ«ãƒ¼ã‚¿ãƒ¼ã§PPPoEçµ‚ç«¯

- ğŸ‘
    - ãƒ‘ã‚¿ãƒ¼ãƒ³Aã¨çµç·šãŒå¤‰ã‚ã‚‰ãªã„
    - IPv4ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ä¸€ç®‡æ‰€ã§çºã‚ã¦ç®¡ç†ã§ãã‚‹
    - PPPoEçµŒè·¯ã¨IPv4 over IPv6çµŒè·¯ã®ãƒ•ã‚£ãƒ«ã‚¿ç®¡ç†ã‚’å…±é€šåŒ–ã§ãã‚‹
- ğŸ‘
    - é›»è©±ã®ãƒˆãƒ©ã‚·ãƒ¥ãƒ¼ã¯HGWã¨æ ¼é—˜ã™ã‚‹ã“ã¨ã«ãªã‚‹
        - ãã‚“ãªäº‹æ…‹ã«é™¥ã£ãŸäº‹ç„¡ã„ã‘ã©ã­

#### C: ãƒ«ãƒ¼ã‚¿ãƒ¼ã§PPPoEçµ‚ç«¯ã‚‚é€šè©±ã‚‚ã‚„ã£ã¡ã‚ƒã†

UNIãƒãƒ¼ãƒˆã‚’å¼•ã£ã“æŠœã„ã¦ãƒ«ãƒ¼ã‚¿ãƒ¼ã«ã¶ã£åˆºã—ã¡ã‚ƒã†ã‚„ã¤([å‚è€ƒ](https://flets.com/hikaridenwa/use/uniport.html))ã€‚

SIPå¯¾å¿œãƒ«ãƒ¼ã‚¿ãƒ¼ãŒå¿…è¦

- ğŸ‘
    - ãƒ‘ã‚¿ãƒ¼ãƒ³Bã®ãƒ¡ãƒªãƒƒãƒˆã¨åŒã˜
    - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ®†ã©ã‚’è‡ªå‰ã®configã§æ‰±ã†ã“ã¨ã«ãªã‚‹ã®ã§ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãŒã‚ãŒã‚‹(å¤§åˆ‡)
- ğŸ‘
    - ã“ã‚Œã‚’ã™ã‚‹å ´åˆã€ãŠå•ã„åˆã‚ã›å…ˆã«ã”é€£çµ¡ãã ã•ã„ã£ã¦æ›¸ã„ã¦ã‚ã‚‹
    - ã“ã‚Œã‚„ã£ã¦ã‚‚HGWå–ã‚Šé™¤ã‘ãªã„ã®ã§ã‚ã¾ã‚Šãƒ¡ãƒªãƒƒãƒˆã‚’æ„Ÿã˜ãªã„(HGWçµæ§‹ãƒ‡ã‚«ã„)
    - NVR700Wã¯PDå†é…å¸ƒã§ãã‚‹ã‘ã©ä»–ã®å¸‚è²©ãƒ«ãƒ¼ã‚¿ãƒ¼ã§ã‚‚PDå†é…å¸ƒã£ã¦æ™®é€šã«ã§ãã‚‹ã®ã‹ãªãƒ»ãƒ»ãƒ»ï¼Ÿ

#### D: å°å‹ONU

æœ€å¼·

å°å‹ONUå¯¾å¿œãƒ«ãƒ¼ã‚¿ãƒ¼ãŒå¿…è¦

- ğŸ‘
    - ãƒ‘ã‚¿ãƒ¼ãƒ³Cã®ãƒ¡ãƒªãƒƒãƒˆã¨åŒã˜
    - **HGWãŒç‰©ç†çš„ã«è¦ã‚‰ãªã„**
- ğŸ‘
    - è¦NTTèª¿æ•´
    - å·¥äº‹è²»ç”¨åˆ¥é€”ã‹ã‹ã‚‹
    - **IIJmioå…‰ã¯ä¸å¯**
        - ã‚‚ã—ã‹ã—ãŸã‚‰ä»–ã®å…‰ã‚³ãƒ©ãƒœã§ã‚‚ç„¡ç†ã‹ã‚‚

#### ä»¥ä¸Šã‚ˆã‚Š

ç¾æ™‚ç‚¹ã§ã¯Bã§ãˆãˆã‹ãªã¨æ€ã£ãŸã®ã§Bã«ã—ãŸã€‚

æ±ç”¨çš„ã«ä½¿ãˆã‚‹çµ„ã¿åˆã‚ã›ã¯ãƒ‘ã‚¿ãƒ¼ãƒ³Bã«ãªã‚‹ã®ã‹ãªã¨æ€ã†ã€‚Cã¨Dã¯ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢çš„åˆ¶ç´„ãŒçµæ§‹å³ã—ã„ã®ã§é¸æŠè‚¢ãŒç›¸å½“çµã‚‰ã‚Œã¦ã—ã¾ã†ã€‚

ã¦ã‹ããã£ãŸã‚‰å‡ºã¦ããŸ[ã“ã¡ã‚‰ã®è¨˜äº‹](https://qiita.com/notoken3331/items/817bb2d2fda30465af6b)ã¨ã»ã¼åŒã˜å†…å®¹ã«ãªã£ã¡ã‚ƒã£ãŸãƒ»ãƒ»ãƒ»ã€‚


### HGWã®è¨­å®š

PPPoEèªè¨¼ã‚’NVR700Wå´ã§ã‚„ã‚‹ã®ã§ä»¥ä¸‹ã®ã“ã¨ã‚’è¡Œã†ã€‚

- PR-400KIå´ã®PPPoEã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’åˆ‡æ–­
- PPPoEãƒ–ãƒªãƒƒã‚¸æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹

å¤šåˆ†LANå´é™çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯è¨­å®šå…¥ã‚Œãªãã¦ã„ã„ã€‚

### NVR700Wã®è¨­å®š

é«˜åº¦ãªäº‹ã—ã¦ãªã„ã®ã§configã¯è²¼ã‚‰ãªã„ï¼

- IIJmioå…‰ã®IPv6 DS-Liteã¯transix IPv4æ¥ç¶šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã‚ˆã‚Šæä¾›ã•ã‚Œã‚‹ã®ã§[multifeedç¤¾æä¾›ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.mfeed.ad.jp/transix/dslite/yamaha.html)ã‚’å‚ç…§ã™ã‚‹
    - NVR700Wã®å ´åˆ`tunnel endpoint address [AFTR ADDRESS]`ã®éƒ¨åˆ†ã‚’`tunnel endpoint name gw.transix.jp`ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§åå‰è§£æ±ºã•ã›ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ãŒã€ã“ã®æ©Ÿèƒ½ã‚’ä½¿ã†ã¨DNSã«DHCPæŒ‡å®šã®ã‚‚ã®ã‚’ä½¿ã‚ãªã„ã¨ã„ã‘ãªã„ã€‚ãã®ãŸã‚ã€æ•¢ãˆã¦`tunnel endpoint address [AFTR ADDRESS]`ã«ã™ã‚‹
- NTTæ±æ—¥æœ¬ãƒ»NTTè¥¿æ—¥æœ¬ãã‚Œãã‚Œã§2ã¤ã®AFTRã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã®ã§ãã‚Œãã‚Œã‚’æŒ‡å®šã—ãŸtunnel interfaceã‚’ä½œæˆã—keepaliveã§å†—é•·åŒ–ã•ã›ã‚‹
- ds-liteã®mtuã¯1460byte
- IPv6ã®prefixå‘¨ã‚Šã®è¨­å®šã¯[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](http://www.rtpro.yamaha.co.jp/RT/manual/rt-common/ipv6/ipv6_prefix.html)ã‚’å‚ç…§ã™ã‚‹
    - configã§ã¯vlanã”ã¨ã«prefixã‚’å¤‰ãˆã¦ã„ã‚‹
- routerã®ä¸‹ã«L3SWãŒã„ã‚‹å ´åˆã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¯„å›²æŒ‡å®šç­‰ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚‹(é©åˆ‡ãªãƒ•ã‚£ãƒ«ã‚¿ãŒã‚ã‚‹ãªã‚‰`dns host any`ã§è‰¯ã„æ°—ãŒã™ã‚‹) -> [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](http://www.rtpro.yamaha.co.jp/RT/manual/nvr500/dns/dns_host.html)
- ã‚ã‚“ã¾ã‚„ã£ã¦ã‚‹äººã„ãªã„æ°—ãŒã™ã‚‹ã‘ã©cloudflareã®dns(`1.1.1.1`)ã‚‚googleã®dns(`8.8.8.8`)ã‚‚IPv6ãŒã‚ã‚‹ã®ã§ãã‚Œã«ã—ãŸ
    - cloudflare: `2606:4700:4700::1111`, `2606:4700:4700::1001`
    - google: `2001:4860:4860::8888`, `2001:4860:4860::8844`

## ãŠã¾ã‘

- ä»¥å‰`show config`ã—ãŸå†…å®¹ã‚’telnetã‹ã‚‰æµã—è¾¼ã‚“ã ã¨ã“ã‚ã€`show config`ã—ãŸå†…å®¹ã«æ”¹è¡Œã‚³ãƒ¼ãƒ‰ãŒå¤‰ãªã¨ã“ã‚ã«å…¥ã£ã¦ã„ã¦æµã—è¾¼ã‚“ã filterã®ç•ªå·ãŒä¸æ­£ã«ãªã£ãŸã€‚ãã®çµæœã€ãã®ãƒ•ã‚£ãƒ«ã‚¿è¨­å®šãŒå«ã¾ã‚Œã‚‹interfaceã§å…¨ã¦ã®packetãŒdropã•ã‚ŒåŸå› ç©¶æ˜ã«æ™‚é–“ãŒã‹ã‹ã£ãŸã€‚
    - `ip pp secure filter out 200013 200020 200021 200022 200023 200024 200025 200026 200027 200099 dynamic 200080 200081 200082 200083 200084 200085 200098 200099`ãŒ`ip pp secure filter out 200013 200020 200021 200022 200023 20`ã«ãªã£ã¡ã‚ƒã†ã¿ãŸã„ãª
    - ã‚³ãƒ”ãƒšæŠ•å…¥ã¯ã‚„ã‚‰ãªã„ã‚ˆã†ã«ã—ãŸã»ã†ãŒè‰¯ã„ãƒ»ãƒ»ãƒ»
- æ¥½å¤©ãƒ¢ãƒã‚¤ãƒ«(UN-LIMIT)ã®simã‚«ãƒ¼ãƒ‰ã‚’æ‰‹ã«å…¥ã‚ŒãŸã®ã§NVR700Wã«å…¥ã‚Œã¦ã¿ãŸã¨ã“ã‚ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å–å¾—ã§ããŸã‚‚ã®ã®globalé€šä¿¡ã§ããªã‹ã£ãŸ
    - IIJmioã®simã‚«ãƒ¼ãƒ‰ã¨ä¼¼ãŸã‚ˆã†ãªæŒ™å‹•
    - ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã®æ›´æ–°ã‚’å¾…ã¡ãŸã„
- æˆ‘ãŒå®¶ã®å›ç·šã®é€Ÿåº¦(ä¸‹ã‚Š)ã«ã¤ã„ã¦
    - IPv4 PPPoEã¯æ·±å¤œç­‰ã®ç©ºã„ã¦ã„ã‚‹æ™‚é–“ãªã‚‰400Mbpsãã‚‰ã„å‡ºã‚‹ãŒãƒ¤ãƒã„æ™‚ã¯æ•°Mbpsãã‚‰ã„ã«ãªã‚‹
    - IPv6 IPoE/IPv4 DS-Liteã¯ãƒ¡ãƒƒãƒãƒ£æ—©ã„ã€‚Ooklaã®ã‚„ã¤ãªã‚‰å¸¸æ™‚4-500Mbpsãã‚‰ã„ã€‚CDNã¨ã®é€šä¿¡ã¯800-900Mbpsãã‚‰ã„ã¾ã§ã„ãã€‚
        - DS-Liteã§è¨ˆæ¸¬ã™ã‚‹ã¨ã‚­ãƒƒãƒãƒªç‰‡ç³»ã®CPUä½¿ç”¨ç‡ãŒ80%-90%ãã‚‰ã„ã«ãªã‚‹ã€‚å…¬ç§°VPNã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ2Gbpsã¨ã„ã†ã®ã¯1GbpsæŒã‘ã‚‹CPUãŒ2ã¤è¼‰ã£ã¦ã„ã‚‹ã®ãŒæ ¹æ‹ ã¿ãŸã„(ç¢ºã‹ã«ãã®ãã‚‰ã„å‡ºã‚‹)ã€‚


export default ({ children }) => <Layout meta={meta}>{children}</Layout>
